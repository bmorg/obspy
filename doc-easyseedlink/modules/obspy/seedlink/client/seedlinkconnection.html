
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>obspy.seedlink.client.seedlinkconnection &mdash; ObsPy Documentation (0.7.x-3204-g87fa0b3c26-dirty)</title>
    
    <link rel="stylesheet" href="../../../../static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/font.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/css/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../../static/css/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.7.x-3204-g87fa0b3c26-dirty',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../../static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../../static/favicon.ico"/>
    <link rel="top" title="ObsPy Documentation (0.7.x-3204-g87fa0b3c26-dirty)" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" />
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -70) };
  if (location.hash) shiftWindow();
  window.addEventListener("hashchange", shiftWindow);
</script>

  </head>
  <body>
<div id="wrapper">
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
<div class="container-fluid">
<div class="navbar-header">
<button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/" class="navbar-brand" title="Home"><span class="icon-obspy"></span>&nbsp;ObsPy</a>
</div>
<div class="navbar-collapse collapse">
<form class="navbar-form navbar-right" role="search" method="get" action="http://docs.obspy.org/search.html">
<div class="form-group">
<input type="text" class="form-control" placeholder="Search Docs" name="q">
</div>
</form>
<ul class="nav navbar-nav navbar-right">
<li><a href="https://github.com/obspy/obspy/" title="GitHub"><span class="icon-github iconx2"></span><span class="hidden-sm">&nbsp;GitHub</span></a></li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Documentation"><span class="glyphicon glyphicon-book iconx2"></span><span class="hidden-sm">&nbsp;Documentation</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Getting&nbsp;Started</li>
<li><a href="http://tutorial.obspy.org/">Tutorial</a></li>
<li><a href="http://gallery.obspy.org/">Gallery</a></li>
<li class="divider"></li>
<li class="dropdown-header">API&nbsp;Documentation&nbsp;(latest&nbsp;release)</li>
<li class="dropdown-submenu">
<a href="#">General&nbsp;Packages</a>
<ul class="dropdown-menu">
<li><a href="http://docs.obspy.org/packages/obspy.core.html">obspy.core</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.imaging.html">obspy.imaging</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.realtime.html">obspy.realtime</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.signal.html">obspy.signal</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.station.html">obspy.station</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.taup.html">obspy.taup</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.xseed.html">obspy.xseed</a></li>
</ul>
</li>
<li class="dropdown-submenu">
<a href="#">Waveform&nbsp;Import/Export</a>
<ul class="dropdown-menu">
<li><a href="http://docs.obspy.org/packages/obspy.css.html">obspy.css</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.datamark.html">obspy.datamark</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.gse2.html">obspy.gse2</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.mseed.html">obspy.mseed</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.sac.html">obspy.sac</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.seisan.html">obspy.seisan</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.seg2.html">obspy.seg2</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.segy.html">obspy.segy</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.sh.html">obspy.sh</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.wav.html">obspy.wav</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.y.html">obspy.y</a></li>
</ul>
</li>
<li class="dropdown-submenu">
<a href="#">Database&nbsp;and&nbsp;Web&nbsp;Service&nbsp;Clients</a>
<ul class="dropdown-menu">
<li><a href="http://docs.obspy.org/packages/obspy.arclink.html">obspy.arclink</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.db.html">obspy.db</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.earthworm.html">obspy.earthworm</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.fdsn.html">obspy.fdsn</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.iris.html">obspy.iris</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.neic.html">obspy.neic</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.neries.html">obspy.neries</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.pde.html">obspy.pde</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.seedlink.html">obspy.seedlink</a></li>
<li><a href="http://docs.obspy.org/packages/obspy.seishub.html">obspy.seishub</a></li>
</ul>
</li>
<li class="divider"></li>
<li class="dropdown-header">API&nbsp;Documentation&nbsp;(current&nbsp;master)</li>
<li class="dropdown-submenu">
<a href="#">General&nbsp;Packages</a>
<ul class="dropdown-menu">
<li><a href="http://docs.obspy.org/master/packages/obspy.core.html">obspy.core</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.imaging.html">obspy.imaging</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.realtime.html">obspy.realtime</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.signal.html">obspy.signal</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.station.html">obspy.station</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.taup.html">obspy.taup</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.xseed.html">obspy.xseed</a></li>
</ul>
</li>
<li class="dropdown-submenu">
<a href="#">Waveform&nbsp;Import/Export</a>
<ul class="dropdown-menu">
<li><a href="http://docs.obspy.org/master/packages/obspy.css.html">obspy.css</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.datamark.html">obspy.datamark</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.gse2.html">obspy.gse2</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.mseed.html">obspy.mseed</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.sac.html">obspy.sac</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.seisan.html">obspy.seisan</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.seg2.html">obspy.seg2</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.segy.html">obspy.segy</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.sh.html">obspy.sh</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.wav.html">obspy.wav</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.y.html">obspy.y</a></li>
</ul>
</li>
<li class="dropdown-submenu">
<a href="#">Event&nbsp;Data&nbsp;Import/Export</a>
<ul class="dropdown-menu">
<li><a href="http://docs.obspy.org/master/packages/obspy.core.quakeml.html">obspy.core.quakeml</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.ndk.html">obspy.ndk</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.pde.html">obspy.pde</a></li>
</ul>
</li>
<li class="dropdown-submenu">
<a href="#">Database&nbsp;and&nbsp;Web&nbsp;Service&nbsp;Clients</a>
<ul class="dropdown-menu">
<li><a href="http://docs.obspy.org/master/packages/obspy.arclink.html">obspy.arclink</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.db.html">obspy.db</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.earthworm.html">obspy.earthworm</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.fdsn.html">obspy.fdsn</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.iris.html">obspy.iris</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.neic.html">obspy.neic</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.neries.html">obspy.neries</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.seedlink.html">obspy.seedlink</a></li>
<li><a href="http://docs.obspy.org/master/packages/obspy.seishub.html">obspy.seishub</a></li>
</ul>
</li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Mailing&nbsp;Lists"><span class="glyphicon glyphicon-envelope iconx2"></span><span class="hidden-sm">&nbsp;Mailing&nbsp;Lists</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li class="dropdown-header">Announcements&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-announcements"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-announcements/"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archive</a></li>
<li class="divider"></li>
<li class="dropdown-header">Users&nbsp;Mailing&nbsp;List&nbsp;(public)</li>
<li><a href="http://lists.swapbytes.de/mailman/listinfo/obspy-users"><span class="glyphicon glyphicon-user"></span>&nbsp;Subscribe</a></li>
<li><a href="http://lists.swapbytes.de/archives/obspy-users"><span class="glyphicon glyphicon-inbox"></span>&nbsp;Archives</a></li>
<li><a href="mailto:users@obspy.org"><span class="glyphicon glyphicon-envelope"></span>&nbsp;Post&nbsp;a&nbsp;message</a></li>
</ul>
</li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Developer&nbsp;Resources"><span class="glyphicon glyphicon-cog iconx2"></span><span class="hidden-sm">&nbsp;Developer&nbsp;Resources</span>&nbsp;<b class="caret"></b></a>
<ul class="dropdown-menu">
<li><a href="https://github.com/obspy/obspy/blob/master/CONTRIBUTING.md">How&nbsp;to&nbsp;contribute</a></li>
<li><a href="http://docs.obspy.org/coding_style.html">Coding&nbsp;Style&nbsp;Guide</a></li>
<li><a href="https://github.com/obspy/obspy/releases/">All&nbsp;Releases</a></li>
<li class="divider"></li>
<li class="dropdown-header">Code&nbsp;Analysis</li>
<li><a href="http://docs.obspy.org/master/pep8/index.html">PEP8</a></li>
<li><a href="http://docs.obspy.org/master/coverage/index.html">Python&nbsp;Coverage</a></li>
<li><a href="http://docs.obspy.org/master/c_coverage/index.html">C&nbsp;Coverage</a></li>
<li><a href="https://coveralls.io/r/obspy/obspy?branch=master">Coveralls</a></li>
<li class="divider"></li>
<li class="dropdown-header">Continuous&nbsp;Integration</li>
<li><a href="http://tests.obspy.org/">Test&nbsp;Reports</a></li>
<li><a href="https://travis-ci.org/obspy/obspy/"><span class="icon-travis"></span>&nbsp;Travis&nbsp;CI</a></li>
</ul>
</li>
</ul>
</div>
</div>
</nav>

<div id="content" class="container">
  
    <div class="breadcrumb pull-right"><a href="../../../../genindex.html" title="General Index"
         accesskey="I">index</a><span style="color: #ccc; padding: 0 5px;">| </span><a href="../../../../py-modindex.html" title="Python Module Index"
         >modules</a>
    </div>
    <ol class="breadcrumb">
        <li><a href="../../../../contents.html">ObsPy Documentation (0.7.x-3204-g87fa0b3c26-dirty)</a></li>
        <li><a href="../../../index.html" accesskey="U">Module code</a></li> 
    </ol>
  
  <h1>Source code for obspy.seedlink.client.seedlinkconnection</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module to manage a connection to a SeedLink server using a Socket.</span>

<span class="sd">Part of Python implementation of libslink of Chad Trabant and</span>
<span class="sd">JSeedLink of Anthony Lomax</span>

<span class="sd">:copyright:</span>
<span class="sd">    The ObsPy Development Team (devs@obspy.org) &amp; Anthony Lomax</span>
<span class="sd">:license:</span>
<span class="sd">    GNU Lesser General Public License, Version 3</span>
<span class="sd">    (http://www.gnu.org/copyleft/lesser.html)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="p">(</span><span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span>
                        <span class="n">unicode_literals</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">future.builtins</span> <span class="kn">import</span> <span class="o">*</span>  <span class="c"># NOQA</span>

<span class="kn">from</span> <span class="nn">obspy.core.utcdatetime</span> <span class="kn">import</span> <span class="n">UTCDateTime</span>
<span class="kn">from</span> <span class="nn">obspy.seedlink.client.slnetstation</span> <span class="kn">import</span> <span class="n">SLNetStation</span>
<span class="kn">from</span> <span class="nn">obspy.seedlink.client.slstate</span> <span class="kn">import</span> <span class="n">SLState</span>
<span class="kn">from</span> <span class="nn">obspy.seedlink.seedlinkexception</span> <span class="kn">import</span> <span class="n">SeedLinkException</span>
<span class="kn">from</span> <span class="nn">obspy.seedlink.slpacket</span> <span class="kn">import</span> <span class="n">SLPacket</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">io</span>


<span class="c"># default logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;obspy.seedlink&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="SeedLinkConnection"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection">[docs]</a><span class="k">class</span> <span class="nc">SeedLinkConnection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to manage a connection to a SeedLink server using a Socket.</span>

<span class="sd">    See obspy.realtime.seedlink.SLClient for an example of how to create</span>
<span class="sd">    and use this SeedLinkConnection object.</span>
<span class="sd">    A new SeedLink application can be created by sub-classing SLClient,</span>
<span class="sd">    or by creating a new class and invoking the methods of SeedLinkConnection.</span>

<span class="sd">    :var SEEDLINK_PROTOCOL_PREFIX: URI/URL prefix for seedlink</span>
<span class="sd">        servers (&quot;seedlink://&quot;).</span>
<span class="sd">    :type SEEDLINK_PROTOCOL_PREFIX: str</span>
<span class="sd">    :var UNISTATION: The station code used for uni-station mode.</span>
<span class="sd">    :type UNISTATION: str</span>
<span class="sd">    :var UNINETWORK: The network code used for uni-station mode.</span>
<span class="sd">    :type UNINETWORK: str</span>
<span class="sd">    :var DFT_READBUF_SIZE: Default size for buffer to hold responses</span>
<span class="sd">        from server (default is 1024).</span>
<span class="sd">    :type DFT_READBUF_SIZE: int</span>
<span class="sd">    :var QUOTE_CHAR: Character used for delimiting timestamp strings in the</span>
<span class="sd">        statefile.</span>
<span class="sd">    :type QUOTE_CHAR: str</span>

<span class="sd">    Publicly accessible (get/set) parameters:</span>

<span class="sd">    :var sladdr: The host:port of the SeedLink server.</span>
<span class="sd">    :type sladdr: str</span>
<span class="sd">    :var keepalive: Interval to send keepalive/heartbeat (seconds)</span>
<span class="sd">        (default is 0 sec).</span>
<span class="sd">    :type keepalive: int</span>
<span class="sd">    :var netto: Network timeout (seconds) (default is 120 sec).</span>
<span class="sd">    :type netto: int</span>
<span class="sd">    :var netdly: Network reconnect delay (seconds)  (default is 30 sec).</span>
<span class="sd">    :type netdly: int</span>
<span class="sd">    :var info_string: String containing concatenation of contents of last</span>
<span class="sd">        terminated set of INFO packets.</span>
<span class="sd">    :type info_string: str</span>
<span class="sd">    :var statefile: File name for storing state information.</span>
<span class="sd">    :type statefile: str</span>
<span class="sd">    :var lastpkttime: Flag to control last packet time usage,</span>
<span class="sd">        if true, begin_time is appended to DATA command (Default is False).</span>
<span class="sd">    :type lastpkttime: bool</span>

<span class="sd">    Protected parameters</span>

<span class="sd">    :var streams: Vector of SLNetStation objects.</span>
<span class="sd">    :type streams: list</span>
<span class="sd">    :var begin_time: Beginning of time window.</span>
<span class="sd">    :type begin_time: str</span>
<span class="sd">    :var end_time: End of time window.</span>
<span class="sd">    :type end_time: str</span>
<span class="sd">    :var resume: Flag to control resuming with sequence numbers.</span>
<span class="sd">    :type resume: bool</span>
<span class="sd">    :var multistation: Flag to indicate multistation mode.</span>
<span class="sd">    :type multistation: bool</span>
<span class="sd">    :var dialup: Flag to indicate dial-up mode.</span>
<span class="sd">    :type dialup: bool</span>
<span class="sd">    :var terminate_flag: Flag to control connection termination.</span>
<span class="sd">    :type terminate_flag: bool</span>
<span class="sd">    :var server_id: ID of the remote SeedLink server.</span>
<span class="sd">    :type server_id: str</span>
<span class="sd">    :var server_version: Version of the remote SeedLink server.</span>
<span class="sd">    :type server_version: float</span>
<span class="sd">    :var info_request_string: INFO level to request.</span>
<span class="sd">    :type info_request_string: str</span>
<span class="sd">    :var socket: The network socket.</span>
<span class="sd">    :type socket: :class:`socket.socket`</span>
<span class="sd">    :var state: Persistent state information.</span>
<span class="sd">    :type state: :class:`~obspy.seedlink.client.SLState`</span>
<span class="sd">    :var infoStrBuf: String to store INFO packet contents.</span>
<span class="sd">    :type infoStrBuf: str</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SEEDLINK_PROTOCOL_PREFIX</span> <span class="o">=</span> <span class="s">&quot;seedlink://&quot;</span>
    <span class="n">UNISTATION</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;UNISTATION&quot;</span>
    <span class="n">UNINETWORK</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;UNINETWORK&quot;</span>
    <span class="n">DFT_READBUF_SIZE</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">QUOTE_CHAR</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;&quot;&#39;</span>

<div class="viewcode-block" id="SeedLinkConnection.__init__"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.__init__.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new instance of SeedLinkConnection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepalive</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netto</span> <span class="o">=</span> <span class="mi">120</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdly</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statefile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastpkttime</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resume</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multistation</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialup</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_flag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_response_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="p">()</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">infoStrBuf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;infoStrBuf was removed in favor of info_response_buffer&#39;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@infoStrBuf.setter</span>
    <span class="k">def</span> <span class="nf">infoStrBuf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  <span class="c"># @UnusedVariable</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;infoStrBuf was removed in favor of info_response_buffer&#39;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<div class="viewcode-block" id="SeedLinkConnection.createInfoString"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.createInfoString.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.createInfoString">[docs]</a>    <span class="k">def</span> <span class="nf">createInfoString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strBuf</span><span class="p">):</span>  <span class="c"># @UnusedVariable</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method was removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;method createInfoString was removed&#39;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.isConnected"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.isConnected.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.isConnected">[docs]</a>    <span class="k">def</span> <span class="nf">isConnected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns connection state of the connection socket.</span>

<span class="sd">        :return: true if connected, false if not connected or socket is not</span>
<span class="sd">            initialized</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">isConnectedImpl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.getState"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getState.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getState">[docs]</a>    <span class="k">def</span> <span class="nf">getState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the SLState state object.</span>

<span class="sd">        :return: the SLState state object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setNetTimout"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setNetTimout.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setNetTimout">[docs]</a>    <span class="k">def</span> <span class="nf">setNetTimout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netto</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the network timeout (seconds).</span>

<span class="sd">        :param netto: the network timeout in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netto</span> <span class="o">=</span> <span class="n">netto</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.getNetTimout"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getNetTimout.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getNetTimout">[docs]</a>    <span class="k">def</span> <span class="nf">getNetTimout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the network timeout (seconds).</span>

<span class="sd">        :return: the network timeout in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">netto</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setKeepAlive"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setKeepAlive.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setKeepAlive">[docs]</a>    <span class="k">def</span> <span class="nf">setKeepAlive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keepalive</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets interval to send keepalive/heartbeat (seconds).</span>

<span class="sd">        :param keepalive: the interval to send keepalive/heartbeat in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepalive</span> <span class="o">=</span> <span class="n">keepalive</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.getKeepAlive"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getKeepAlive.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getKeepAlive">[docs]</a>    <span class="k">def</span> <span class="nf">getKeepAlive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the interval to send keepalive/heartbeat (seconds).</span>

<span class="sd">        :return: the interval to send keepalive/heartbeat in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keepalive</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setNetDelay"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setNetDelay.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setNetDelay">[docs]</a>    <span class="k">def</span> <span class="nf">setNetDelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">netdly</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the network reconnect delay (seconds).</span>

<span class="sd">        :param netdly: the network reconnect delay in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdly</span> <span class="o">=</span> <span class="n">netdly</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.getNetDelay"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getNetDelay.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getNetDelay">[docs]</a>    <span class="k">def</span> <span class="nf">getNetDelay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the network reconnect delay (seconds).</span>

<span class="sd">        :return: the network reconnect delay in seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdly</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setSLAddress"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setSLAddress.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setSLAddress">[docs]</a>    <span class="k">def</span> <span class="nf">setSLAddress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sladdr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the host:port of the SeedLink server.</span>

<span class="sd">        :param sladdr: the host:port of the SeedLink server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">SEEDLINK_PROTOCOL_PREFIX</span>
        <span class="k">if</span> <span class="n">sladdr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sladdr</span><span class="p">[</span><span class="n">prefix</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span> <span class="o">=</span> <span class="n">sladdr</span>
        <span class="c"># set logger format</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot; obspy.seedlink [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sladdr</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setLastpkttime"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setLastpkttime.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setLastpkttime">[docs]</a>    <span class="k">def</span> <span class="nf">setLastpkttime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lastpkttime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Sets a specified start time for beginning of data transmission .</span>

<span class="sd">        :param lastpkttime: if true, beginning time of last packet received</span>
<span class="sd">            for each station is appended to DATA command on resume.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastpkttime</span> <span class="o">=</span> <span class="n">lastpkttime</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setBeginTime"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setBeginTime.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setBeginTime">[docs]</a>    <span class="k">def</span> <span class="nf">setBeginTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startTimeStr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Sets begin_time for initiation of continuous data transmission.</span>

<span class="sd">        :param startTimeStr: start time in in SeedLink string format:</span>
<span class="sd">            &quot;year,month,day,hour,minute,second&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">startTimeStr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">startTimeStr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setEndTime"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setEndTime.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setEndTime">[docs]</a>    <span class="k">def</span> <span class="nf">setEndTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endTimeStr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Sets end_time for termination of data transmission.</span>

<span class="sd">        :param endTimeStr: start time in in SeedLink string format:</span>
<span class="sd">            &quot;year,month,day,hour,minute,second&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">endTimeStr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">endTimeStr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.terminate"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.terminate.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.terminate">[docs]</a>    <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets terminate flag, closes connection and clears state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_flag</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.getSLAddress"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getSLAddress.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getSLAddress">[docs]</a>    <span class="k">def</span> <span class="nf">getSLAddress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the host:port of the SeedLink server.</span>

<span class="sd">        :return: the host:port of the SeedLink server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.getStreams"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getStreams.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getStreams">[docs]</a>    <span class="k">def</span> <span class="nf">getStreams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a copy of the Vector of SLNetStation objects.</span>

<span class="sd">        :return: a copy of the Vector of SLNetStation objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.getInfoString"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getInfoString.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.getInfoString">[docs]</a>    <span class="k">def</span> <span class="nf">getInfoString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the results of the last INFO request.</span>

<span class="sd">       :return: concatenation of contents of last terminated set of INFO</span>
<span class="sd">           packets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_string</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.checkslcd"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.checkslcd.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.checkslcd">[docs]</a>    <span class="k">def</span> <span class="nf">checkslcd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check this SeedLinkConnection description has valid parameters.</span>

<span class="sd">        :return: true if pass and false if problems were identified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;stream chain AND info type are empty&quot;</span><span class="p">)</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">ndx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;server address </span><span class="si">%s</span><span class="s"> is empty&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">))</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ndx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndx</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ndx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;host address  </span><span class="si">%s</span><span class="s"> is not in &#39;[hostname]:port&#39; format&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">))</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">retval</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.readStreamList"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.readStreamList.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.readStreamList">[docs]</a>    <span class="k">def</span> <span class="nf">readStreamList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamfile</span><span class="p">,</span> <span class="n">defselect</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a list of streams and selectors from a file and add them to the</span>
<span class="sd">        stream chain for configuring a multi-station connection.</span>

<span class="sd">        If &#39;defselect&#39; is not null it will be used as the default selectors</span>
<span class="sd">        for entries will no specific selectors indicated.</span>

<span class="sd">        The file is expected to be repeating lines of the form::</span>

<span class="sd">            &lt;NET&gt; &lt;STA&gt; [selectors]</span>

<span class="sd">        For example::</span>

<span class="sd">            # Comment lines begin with a &#39;#&#39; or &#39;*&#39;</span>
<span class="sd">            GE ISP  BH?.D</span>
<span class="sd">            NL HGN</span>
<span class="sd">            MN AQU  BH?  HH?</span>

<span class="sd">        :param streamfile: name of file containing list of streams and</span>
<span class="sd">            selectors.</span>
<span class="sd">        :param defselect: default selectors.</span>
<span class="sd">        :return: the number of streams configured.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Open the stream list file</span>
        <span class="n">streamfile_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">streamfile_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">streamfile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;cannot open state file </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ioe</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: opening state file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">streamfile</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s">&quot;recovering connection state from state file </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">streamfile</span><span class="p">))</span>
        <span class="n">linecount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stacount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">streamfile_file</span><span class="p">:</span>
                <span class="n">linecount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">):</span>
                    <span class="c"># comment lines</span>
                    <span class="k">continue</span>
                <span class="n">net</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">station</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">selectors_str</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">net</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">station</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">selectors_str</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="n">selectors_str</span> <span class="o">+=</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">token</span>
                <span class="k">if</span> <span class="n">net</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;invalid or missing network string at line &quot;</span> <span class="o">+</span> \
                        <span class="s">&quot;</span><span class="si">%s</span><span class="s"> of stream list file: </span><span class="si">%s</span><span class="s">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">linecount</span><span class="p">,</span> <span class="n">streamfile</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">station</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;invalid or missing station string at line &quot;</span> <span class="o">+</span> \
                        <span class="s">&quot;</span><span class="si">%s</span><span class="s"> of stream list file: </span><span class="si">%s</span><span class="s">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">linecount</span><span class="p">,</span> <span class="n">streamfile</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">selectors_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addStream</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">selectors_str</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                    <span class="n">stacount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addStream</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">defselect</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                    <span class="n">stacount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stacount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;no streams defined in </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">streamfile</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Read </span><span class="si">%s</span><span class="s"> streams from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stacount</span><span class="p">,</span>
                                                          <span class="n">streamfile</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: reading stream list file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">streamfile</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">streamfile_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">stacount</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.parseStreamlist"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.parseStreamlist.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.parseStreamlist">[docs]</a>    <span class="k">def</span> <span class="nf">parseStreamlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streamlist</span><span class="p">,</span> <span class="n">defselect</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a string of streams and selectors and add them to the stream</span>
<span class="sd">        chain for configuring a multi-station connection.</span>

<span class="sd">        The string should be of the following form::</span>

<span class="sd">            &quot;stream1[:selectors1],stream2[:selectors2],...&quot;</span>

<span class="sd">        For example::</span>

<span class="sd">            &quot;IU_KONO:BHE BHN,GE_WLF,MN_AQU:HH?.D&quot;</span>

<span class="sd">        :param streamlist: list of streams and selectors.</span>
<span class="sd">        :param defselect: default selectors.</span>

<span class="sd">        :return: the number of streams configured.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Parse the streams and selectors</span>

        <span class="c"># print &quot;DEBUG: streamlist:&quot;, streamlist</span>
        <span class="n">stacount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">streamToken</span> <span class="ow">in</span> <span class="n">streamlist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">):</span>
            <span class="n">streamToken</span> <span class="o">=</span> <span class="n">streamToken</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">net</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">station</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">staselect</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">configure</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">reqTkz</span> <span class="o">=</span> <span class="n">streamToken</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">reqToken</span> <span class="o">=</span> <span class="n">reqTkz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">netStaTkz</span> <span class="o">=</span> <span class="n">reqToken</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
            <span class="c"># Fill in the NET and STA fields</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">netStaTkz</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;not in NET_STA format: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reqToken</span><span class="p">))</span>
                <span class="n">configure</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># First token, should be a network code</span>
                <span class="n">net</span> <span class="o">=</span> <span class="n">netStaTkz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">net</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;not in NET_STA format: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reqToken</span><span class="p">))</span>
                    <span class="n">configure</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Second token, should be a station code</span>
                    <span class="n">station</span> <span class="o">=</span> <span class="n">netStaTkz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">station</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;not in NET_STA format: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reqToken</span><span class="p">))</span>
                        <span class="n">configure</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reqTkz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">staselect</span> <span class="o">=</span> <span class="n">reqTkz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">staselect</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;empty selector: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reqToken</span><span class="p">))</span>
                        <span class="n">configure</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># If no specific selectors, use the default</span>
                    <span class="n">staselect</span> <span class="o">=</span> <span class="n">defselect</span>
                <span class="c"># print &quot;DEBUG: staselect:&quot;, staselect</span>
                <span class="c"># Add this to the stream chain</span>
                <span class="k">if</span> <span class="n">configure</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addStream</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">staselect</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                    <span class="n">stacount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">stacount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;no streams defined in stream list&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">stacount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;parsed </span><span class="si">%d</span><span class="s"> streams from stream list&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stacount</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stacount</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.addStream"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.addStream.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.addStream">[docs]</a>    <span class="k">def</span> <span class="nf">addStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">selectors_str</span><span class="p">,</span> <span class="n">seqnum</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new stream entry to the stream chain for the given net/station</span>
<span class="sd">        parameters.</span>

<span class="sd">        If the stream entry already exists do nothing and return 1.</span>
<span class="sd">        Also sets the multi-station flag to true.</span>

<span class="sd">        :param net: network code.</span>
<span class="sd">        :param station: station code.</span>
<span class="sd">        :param selectors_str: selectors for this net/station, null if none.</span>
<span class="sd">        :param seqnum: SeedLink sequence number of last packet received, -1 to</span>
<span class="sd">            start at the next data.</span>
<span class="sd">        :param timestamp: SeedLink time stamp in a UTCDateTime format</span>
<span class="sd">            for last packet received, null for none.</span>

<span class="sd">        :return: 0 if successfully added, 1 if an entry for network and station</span>
<span class="sd">            already exists.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Sanity, check for a uni-station mode entry</span>
        <span class="c"># print &quot;DEBUG: selectors_str:&quot;, selectors_str</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">net</span> <span class="o">==</span> <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">UNINETWORK</span> <span class="ow">and</span> \
               <span class="n">stream</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">UNISTATION</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;addStream called, but uni-station mode configured!&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">selectors_str</span><span class="p">:</span>
            <span class="n">selectors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selectors</span> <span class="o">=</span> <span class="n">selectors_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="c"># Search the stream chain if net/station/selector already present</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">net</span> <span class="o">==</span> <span class="n">net</span> <span class="ow">and</span> <span class="n">stream</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="n">station</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stream</span><span class="o">.</span><span class="n">appendSelectors</span><span class="p">(</span><span class="n">selectors_str</span><span class="p">)</span>

        <span class="c"># Add new stream</span>
        <span class="n">newstream</span> <span class="o">=</span> <span class="n">SLNetStation</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">selectors</span><span class="p">,</span> <span class="n">seqnum</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newstream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multistation</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="mi">0</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setUniParams"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setUniParams.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setUniParams">[docs]</a>    <span class="k">def</span> <span class="nf">setUniParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selectors_str</span><span class="p">,</span> <span class="n">seqnum</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the parameters for a uni-station mode connection for the</span>
<span class="sd">        given SLCD struct.  If the stream entry already exists, overwrite</span>
<span class="sd">        the previous settings.</span>
<span class="sd">        Also sets the multi-station flag to 0 (false).</span>

<span class="sd">        :param selectors: selectors for this net/station, null if none.</span>
<span class="sd">        :param seqnum: SeedLink sequence number of last packet received,</span>
<span class="sd">            -1 to start at the next data.</span>
<span class="sd">        :param timestamp: SeedLink time stamp in a UTCDateTime format</span>
<span class="sd">            for last packet received, null for none.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Sanity, check for a multi-station mode entry</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">stream</span><span class="o">.</span><span class="n">net</span> <span class="o">==</span> <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">UNINETWORK</span> <span class="ow">or</span> \
               <span class="ow">not</span> <span class="n">stream</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">UNISTATION</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;setUniParams called, but multi-station mode configured!&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">selectors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">selectors_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">selectors_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">selectors</span> <span class="o">=</span> <span class="n">selectors_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="c"># Add new stream</span>
        <span class="n">newstream</span> <span class="o">=</span> <span class="n">SLNetStation</span><span class="p">(</span><span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">UNINETWORK</span><span class="p">,</span>
                                 <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">UNISTATION</span><span class="p">,</span> <span class="n">selectors</span><span class="p">,</span>
                                 <span class="n">seqnum</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newstream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multistation</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.setStateFile"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setStateFile.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.setStateFile">[docs]</a>    <span class="k">def</span> <span class="nf">setStateFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statefile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the state file and recover state.</span>

<span class="sd">        :param statefile: path and name of statefile.</span>
<span class="sd">        :return: the number of stream chains recovered.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statefile</span> <span class="o">=</span> <span class="n">statefile</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recoverState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.recoverState"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.recoverState.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.recoverState">[docs]</a>    <span class="k">def</span> <span class="nf">recoverState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statefile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recover the state file and put the sequence numbers and time stamps</span>
<span class="sd">        into the pre-existing stream chain entries.</span>

<span class="sd">        :param statefile: path and name of statefile.</span>
<span class="sd">        :return: the number of stream chains recovered.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># open the state file</span>
        <span class="n">statefile_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">statefile_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;cannot open state file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ioe</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: opening state file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">statefile</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># recover the state</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;recovering connection state from state file: </span><span class="si">%s</span><span class="s">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">))</span>
        <span class="n">linecount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stacount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">statefile_file</span><span class="p">:</span>
                <span class="n">linecount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">):</span>
                    <span class="c"># comment lines</span>
                    <span class="k">continue</span>
                <span class="n">net</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">station</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">seqnum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">timeStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">net</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">station</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">seqnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">timeStr</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="c"># check for completeness of read</span>
                <span class="k">if</span> <span class="n">timeStr</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;error parsing line of state file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">timeStr</span> <span class="o">==</span> <span class="s">&quot;null&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c"># Search for a matching net/station in the stream chain</span>
                <span class="n">stream</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">)):</span>
                    <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">net</span> <span class="o">==</span> <span class="n">net</span> <span class="ow">and</span> <span class="n">stream</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="n">station</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">stream</span> <span class="o">=</span> <span class="bp">None</span>

                <span class="c"># update net/station entry in the stream chain</span>
                <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">stream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">=</span> <span class="n">seqnum</span>
                    <span class="k">if</span> <span class="n">timeStr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c"># AJL stream.btime = Btime(timeStr)</span>
                            <span class="n">stream</span><span class="o">.</span><span class="n">btime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="n">timeStr</span><span class="p">)</span>
                            <span class="n">stacount</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">except</span> <span class="n">SeedLinkException</span> <span class="k">as</span> <span class="n">sle</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;parsing timestamp in line </span><span class="si">%s</span><span class="s"> of state &quot;</span> <span class="o">+</span> \
                                <span class="s">&quot;file: </span><span class="si">%s</span><span class="s">&quot;</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">linecount</span><span class="p">,</span> <span class="n">sle</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;parsing timestamp in line </span><span class="si">%s</span><span class="s"> of state &quot;</span> <span class="o">+</span> \
                                <span class="s">&quot;file: </span><span class="si">%s</span><span class="s">&quot;</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">linecount</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stacount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;no matching streams found in </span><span class="si">%s</span><span class="s">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;recovered state for </span><span class="si">%s</span><span class="s"> streams in </span><span class="si">%s</span><span class="s">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">stacount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: reading state file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">statefile_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">stacount</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.saveState"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.saveState.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.saveState">[docs]</a>    <span class="k">def</span> <span class="nf">saveState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statefile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save all current sequence numbers and time stamps into the</span>
<span class="sd">        given state file.</span>

<span class="sd">        :param statefile: path and name of statefile.</span>
<span class="sd">        :return: the number of stream chains saved.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># open the state file</span>
        <span class="n">statefile_file</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">statefile_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;cannot open state file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ioe</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: opening state file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">statefile</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;saving connection state to state file&quot;</span><span class="p">)</span>
        <span class="n">stacount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># Loop through the stream chain</span>
            <span class="k">for</span> <span class="n">curstream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
                <span class="c"># print &quot;DEBUG: curstream:&quot;, curstream.net, curstream.station,</span>
                <span class="c"># print curstream.btime</span>
                <span class="k">if</span> <span class="n">curstream</span><span class="o">.</span><span class="n">btime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">statefile_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">curstream</span><span class="o">.</span><span class="n">net</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span>
                        <span class="n">curstream</span><span class="o">.</span><span class="n">station</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">curstream</span><span class="o">.</span><span class="n">btime</span><span class="o">.</span><span class="n">formatSeedLink</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: writing state file: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">statefile_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">stacount</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.doTerminate"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.doTerminate.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.doTerminate">[docs]</a>    <span class="k">def</span> <span class="nf">doTerminate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Terminate the collection loop.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;terminating collect loop&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_response_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">SLPacket</span><span class="o">.</span><span class="n">SLTERMINATE</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.collect"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.collect.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.collect">[docs]</a>    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manage a connection to a SeedLink server based on the values</span>
<span class="sd">        given in this SeedLinkConnection, and to collect data.</span>

<span class="sd">        Designed to run in a tight loop at the heart of a client program, this</span>
<span class="sd">        function will return every time a packet is received.</span>

<span class="sd">        :return: an SLPacket when something is received.</span>
<span class="sd">        :return: null when the connection was closed by</span>
<span class="sd">            the server or the termination sequence completed.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_flag</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># Check if the infoRequestString was set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">query_mode</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">INFO_QUERY</span>

        <span class="c"># If the connection is not up check this SeedLinkConnection and reset</span>
        <span class="c"># the timing variables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkslcd</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;problems with the connection description&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">previous_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="c"># print &quot;DEBUG: self.state.previous_time set:&quot;,</span>
            <span class="c"># print self.state.previous_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># Start the primary loop</span>
        <span class="n">npass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;primary loop pass </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npass</span><span class="p">))</span>
            <span class="c"># print &quot;DEBUG: self.state.state:&quot;, self.state.state</span>
            <span class="n">npass</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c"># we are terminating (abnormally!)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_flag</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doTerminate</span><span class="p">()</span>

            <span class="c"># not terminating</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isConnected</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span>

            <span class="c"># Check for network timeout</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DATA</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">netto</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;network timeout (</span><span class="si">%s</span><span class="s">), reconnecting in </span><span class="si">%s</span><span class="s">s&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netto</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdly</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="c"># Check if a keepalive packet needs to be sent</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DATA</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">keepalive</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_trig</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;sending: keepalive request&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sendInfoRequest</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">query_mode</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">KEEP_ALIVE_QUERY</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;I/O error, reconnecting in </span><span class="si">%s</span><span class="s">s&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netdly</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span>

            <span class="c"># Check if an in-stream INFO request needs to be sent</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DATA</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sendInfoRequest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">query_mode</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">INFO_QUERY</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">query_mode</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">NO_QUERY</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;I/O error, reconnecting in </span><span class="si">%s</span><span class="s">s&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netdly</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="c"># Throttle the loop while delaying</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="c"># Connect to remote SeedLink server</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_UP</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="c"># traceback.print_exc()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="c"># Negotiate/configure the connection</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_UP</span><span class="p">:</span>

                <span class="c"># Send query if a query is set, stream configuration will be</span>
                <span class="c"># done only after query is fully returned</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sendInfoRequest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">query_mode</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">INFO_QUERY</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;SeedLink version does not support INFO requests&quot;</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">query_mode</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">NO_QUERY</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;I/O error, reconnecting in </span><span class="si">%s</span><span class="s">s&quot;</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netdly</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">configLink</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">recptr</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">sendptr</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DATA</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;negotiation with remote SeedLink failed: </span><span class="si">%s</span><span class="s">&quot;</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c"># Process data in our buffer and then read incoming data</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DATA</span> <span class="ow">or</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span><span class="p">):</span>

                <span class="c"># Process data in buffer</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">packetAvailable</span><span class="p">():</span>
                    <span class="n">slpacket</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="n">sendpacket</span> <span class="o">=</span> <span class="bp">True</span>

                    <span class="c"># Check for an INFO packet</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">packetIsInfo</span><span class="p">():</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">sendptr</span> <span class="o">+</span> <span class="n">SLPacket</span><span class="o">.</span><span class="n">SLHEADSIZE</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">terminator</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">databuf</span><span class="p">[</span><span class="n">temp</span><span class="p">])</span> <span class="o">!=</span> <span class="s">&#39;*&#39;</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;unexpected INFO packet received, skipping&quot;</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">terminator</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span> <span class="o">=</span> <span class="bp">False</span>

                            <span class="c"># Keep alive packets are not returned</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">query_mode</span> <span class="o">==</span> \
                               <span class="n">SLState</span><span class="o">.</span><span class="n">KEEP_ALIVE_QUERY</span><span class="p">:</span>
                                <span class="n">sendpacket</span> <span class="o">=</span> <span class="bp">False</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">terminator</span><span class="p">:</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                        <span class="s">&quot;non-terminated &quot;</span> <span class="o">+</span>
                                        <span class="s">&quot;keep-alive packet received!?!&quot;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;keepalive packet received&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">slpacket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">getPacket</span><span class="p">()</span>
                                <span class="c"># construct info String</span>
                                <span class="n">packet_type</span> <span class="o">=</span> <span class="n">slpacket</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
                                <span class="c"># print &quot;DEBUG: slpacket.getType():&quot;,</span>
                                <span class="c"># print slpacket.getType()</span>
                                <span class="c"># print &quot;DEBUG: SLPacket.TYPE_SLINF:&quot;,</span>
                                <span class="c"># print SLPacket.TYPE_SLINF</span>
                                <span class="c"># print &quot;DEBUG: SLPacket.TYPE_SLINFT:&quot;,</span>
                                <span class="c"># print SLPacket.TYPE_SLINFT</span>
                                <span class="n">data</span> <span class="o">=</span> <span class="n">slpacket</span><span class="o">.</span><span class="n">getStringPayload</span><span class="p">()</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">info_response_buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                                <span class="k">if</span> <span class="p">(</span><span class="n">packet_type</span> <span class="o">==</span> <span class="n">SLPacket</span><span class="o">.</span><span class="n">TYPE_SLINFT</span><span class="p">):</span>
                                    <span class="c"># Terminated INFO response packet</span>
                                    <span class="c"># -&gt; build complete INFO response string,</span>
                                    <span class="c">#    strip NULL bytes from the end</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">info_string</span> <span class="o">=</span> \
                                        <span class="bp">self</span><span class="o">.</span><span class="n">info_response_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span>\
                                        <span class="n">decode</span><span class="p">(</span><span class="s">&#39;ASCII&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">)</span><span class="o">.</span>\
                                        <span class="n">replace</span><span class="p">(</span><span class="s">&quot;&gt;&lt;&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)</span>

                                    <span class="bp">self</span><span class="o">.</span><span class="n">info_response_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">query_mode</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">NO_QUERY</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># Get packet and update the stream chain entry if not</span>
                        <span class="c"># an INFO packet</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">slpacket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">getPacket</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">updateStream</span><span class="p">(</span><span class="n">slpacket</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">saveState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">)</span>
                        <span class="k">except</span> <span class="n">SeedLinkException</span> <span class="k">as</span> <span class="n">sle</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;bad packet: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sle</span><span class="p">))</span>
                            <span class="n">sendpacket</span> <span class="o">=</span> <span class="bp">False</span>

                    <span class="c"># Increment the send pointer</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">incrementSendPointer</span><span class="p">()</span>

                    <span class="c"># After processing the packet buffer shift the data</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">packDataBuffer</span><span class="p">()</span>

                    <span class="c"># Return packet</span>
                    <span class="k">if</span> <span class="n">sendpacket</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">slpacket</span>

                <span class="c"># A trap door for terminating, all complete data packets from</span>
                <span class="c"># the buffer have been sent to the caller we are terminating</span>
                <span class="c"># (abnormally!)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_flag</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">doTerminate</span><span class="p">()</span>

                <span class="c"># Catch cases where the data stream stopped</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">isError</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s">&quot;SeedLink reported an error with the last command&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">SLPacket</span><span class="o">.</span><span class="n">SLERROR</span>
                <span class="k">except</span> <span class="n">SeedLinkException</span> <span class="k">as</span> <span class="n">sle</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c"># not enough bytes to determine packet type</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">isEnd</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;end of buffer or selected time window&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                        <span class="k">return</span> <span class="n">SLPacket</span><span class="o">.</span><span class="n">SLTERMINATE</span>
                <span class="k">except</span> <span class="n">SeedLinkException</span> <span class="k">as</span> <span class="n">sle</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c"># Check for more available data from the socket</span>
                <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receiveData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">bytesRemaining</span><span class="p">(),</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;socket read error: </span><span class="si">%s</span><span class="s">, reconnecting in </span><span class="si">%s</span><span class="s">ss&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">ioe</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdly</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="o">.</span><span class="n">SL_DOWN</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">bytesread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytesread</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># Data is here, process it</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">appendBytes</span><span class="p">(</span><span class="n">bytesread</span><span class="p">)</span>
                    <span class="c"># Reset the timeout and keepalive timers</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_trig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="c"># Update timing variables when more than a 1/4 second has passed</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="c"># print &quot;DEBUG: if now - self.state.previous_time &gt;= 0.25:&quot;, now,</span>
            <span class="c"># print self.state.previous_time, now - self.state.previous_time</span>
            <span class="k">if</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">previous_time</span> <span class="o">&gt;=</span> <span class="mf">0.25</span><span class="p">:</span>
                <span class="c"># print &quot;DEBUG: now - self.state.previous_time &gt;= 0.25:&quot;,</span>
                <span class="c"># print self.state.previous_time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">previous_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="c"># print &quot;DEBUG: self.state.previous_time set:&quot;,</span>
                <span class="c"># print self.state.previous_time</span>

                <span class="c"># Network timeout timing logic</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">netto</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_time</span> <span class="o">=</span> <span class="n">now</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> \
                            <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">netto</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netto_trig</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="c"># print &quot;DEBUG: self.keepalive:&quot;, self.keepalive</span>

                <span class="c"># Keepalive/heartbeat interval timing logic</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keepalive</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># print &quot;DEBUG: self.state.keepalive_trig:&quot;,</span>
                    <span class="c"># print self.state.keepalive_trig</span>
                    <span class="c"># print &quot;DEBUG: now - self.state.keepalive_time&quot;,</span>
                    <span class="c"># print &quot; &gt;=self.keepalive:&quot;, self.state.previous_time,</span>
                    <span class="c"># print now - self.state.keepalive_time, self.keepalive</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_trig</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_time</span> <span class="o">=</span> <span class="n">now</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_trig</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_trig</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> \
                            <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">keepalive</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keepalive_trig</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c"># Network delay timing logic</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdly</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_time</span> <span class="o">=</span> <span class="n">now</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                            <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdly</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">netdly_trig</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># End of primary loop</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.connect"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.connect.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a network socket connection to a SeedLink server. Expects sladdr</span>
<span class="sd">        to be in &#39;host:port&#39; format.</span>

<span class="sd">        :raise SeedLinkException: on error or no response or bad response from</span>
<span class="sd">            server.</span>
<span class="sd">        :raise IOException: if an I/O error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="mf">4.0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">host_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)]</span>
            <span class="n">nport</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

            <span class="c"># create and connect Socket</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_RCVBUF</span><span class="p">,</span> <span class="mi">65536</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_KEEPALIVE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c"># print &quot;DEBUG: sock.connect:&quot;, self.sladdr, host_name, nport</span>
            <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host_name</span><span class="p">,</span> <span class="n">nport</span><span class="p">))</span>
            <span class="c"># print &quot;DEBUG: sock.connect: sock:&quot;, sock</span>
            <span class="k">if</span> <span class="n">sock</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">sock</span>

            <span class="c"># Check if socket is connected</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isConnected</span><span class="p">(</span><span class="n">timeout</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;socket connect time-out </span><span class="si">%s</span><span class="s">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="c"># socket connected</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;network socket opened&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">netto</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;cannot connect to SeedLink server: </span><span class="si">%s</span><span class="s">&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="c"># Everything should be connected, say hello</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sayHello</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">SeedLinkException</span> <span class="k">as</span> <span class="n">sle</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">raise</span> <span class="n">sle</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="c"># traceback.print_exc()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">raise</span> <span class="n">ioe</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.disconnect"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.disconnect.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the network socket associated with this connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;network socket close failed: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ioe</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;network socket closed&quot;</span><span class="p">)</span>

        <span class="c"># make sure previous state is cleaned up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">SLState</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.close"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.close.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes this SeedLinkConnection by closing the network socket and saving</span>
<span class="sd">        the state to the statefile, if it exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;closing SeedLinkConnection()&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saveState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statefile</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">SeedLinkException</span> <span class="k">as</span> <span class="n">sle</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">sle</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.isConnectedImpl"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.isConnectedImpl.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.isConnectedImpl">[docs]</a>    <span class="k">def</span> <span class="nf">isConnectedImpl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check a socket for write ability using select()</span>

<span class="sd">        Time-out values are also passed (seconds) for the select() call.</span>

<span class="sd">        :return: 1 = success, 0 = if time-out expires, -1 = errors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ready_to_write</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">sock</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ready_to_write</span><span class="p">)</span> <span class="ow">and</span> \
              <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>

            <span class="n">_ready_to_read</span><span class="p">,</span> <span class="n">ready_to_write</span><span class="p">,</span> <span class="n">_in_error</span> <span class="o">=</span> \
                <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sock</span><span class="p">],</span> <span class="p">[</span><span class="n">sock</span><span class="p">],</span> <span class="p">[],</span> <span class="n">timeout</span><span class="p">)</span>

        <span class="c"># print &quot;DEBUG: sock:&quot;, sock</span>
        <span class="c"># print &quot;DEBUG: ready_to_read:&quot;, ready_to_read</span>
        <span class="c"># print &quot;DEBUG: ready_to_write:&quot;, ready_to_write</span>
        <span class="c"># print &quot;DEBUG: in_error:&quot;, in_error</span>
        <span class="k">if</span> <span class="n">sock</span> <span class="ow">in</span> <span class="n">ready_to_write</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.sendData"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.sendData.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.sendData">[docs]</a>    <span class="k">def</span> <span class="nf">sendData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sendbytes</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">resplen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send bytes to the server. This is only designed for small pieces of</span>
<span class="sd">        data, specifically for when the server responses to commands.</span>

<span class="sd">        :param sendbytes: bytes to send.</span>
<span class="sd">        :param code: a string to include in error messages for identification.</span>
<span class="sd">        :param resplen: if &gt; 0 then read up to resplen response bytes after</span>
<span class="sd">            sending.</span>
<span class="sd">        :return: the response bytes or null if no response requested.</span>

<span class="sd">        :raise SeedLinkException: on error or no or bad response from server.</span>
<span class="sd">        :raise IOException: if an I/O error occurs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># print &quot;DEBUG: sendbytes:&quot;, repr(sendbytes)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sendbytes</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ioe</span>

        <span class="k">if</span> <span class="n">resplen</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># no response requested</span>
            <span class="k">return</span>

        <span class="c"># If requested, wait up to 30 seconds for a response</span>
        <span class="n">ackcnt</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># counter for the read loop</span>
        <span class="n">ackpoll</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c"># poll at 0.05 seconds for reading</span>
        <span class="n">ackcntmax</span> <span class="o">=</span> <span class="mi">30000</span> <span class="o">/</span> <span class="n">ackpoll</span>  <span class="c"># 30 second wait</span>
        <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receiveData</span><span class="p">(</span><span class="n">resplen</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">bytesread</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytesread</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ackcnt</span> <span class="o">&gt;</span> <span class="n">ackcntmax</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;[</span><span class="si">%s</span><span class="s">] no response from SeedLink server to &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">sendbytes</span><span class="p">))</span>
            <span class="n">sleep_time</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">ackpoll</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>
            <span class="n">ackcnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">receiveData</span><span class="p">(</span><span class="n">resplen</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bytesread</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;[</span><span class="si">%s</span><span class="s">] bad response to &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">sendbytes</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">bytesread</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.receiveData"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.receiveData.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.receiveData">[docs]</a>    <span class="k">def</span> <span class="nf">receiveData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxbytes</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read bytes from the server.</span>

<span class="sd">        :param maxbytes: maximum number of bytes to read.</span>
<span class="sd">        :param code: a string to include in error messages for identification.</span>
<span class="sd">        :return: the response bytes (zero length if no available data), or null</span>
<span class="sd">            if EOF.</span>

<span class="sd">        :raise IOException: if an I/O error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># read up to maxbytes</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># self.socket.setblocking(0)</span>
            <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">maxbytes</span><span class="p">)</span>
            <span class="c"># self.socket.setblocking(1)</span>
        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ioe</span><span class="p">:</span>
            <span class="c"># traceback.print_exc()</span>
            <span class="k">raise</span> <span class="n">ioe</span>
        <span class="c"># print &quot;DEBUG: bytesread:&quot;, repr(bytesread)</span>
        <span class="n">nbytesread</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bytesread</span><span class="p">)</span>

        <span class="c"># check for end or no bytes read</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nbytesread</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="c"># XXX This is never true</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;[</span><span class="si">%s</span><span class="s">] socket.read(): </span><span class="si">%s</span><span class="s">: TCP FIN or EOF received&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">nbytesread</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nbytesread</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">b</span><span class="s">&quot;&quot;</span>

        <span class="k">return</span> <span class="n">bytesread</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.sayHello"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.sayHello.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.sayHello">[docs]</a>    <span class="k">def</span> <span class="nf">sayHello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the HELLO command and attempt to parse the server version</span>
<span class="sd">        number from the returned string.  The server version is set to 0.0</span>
<span class="sd">        if it can not be parsed from the returned string.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        :raise IOException: if an I/O error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sendStr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;HELLO&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;sending: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sendStr</span><span class="o">.</span><span class="n">decode</span><span class="p">()))</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="n">sendStr</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span>
        <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendData</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">,</span>
                                  <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">DFT_READBUF_SIZE</span><span class="p">)</span>

        <span class="c"># Parse the server ID and version from the returned string</span>
        <span class="n">servstr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">servstr</span> <span class="o">=</span> <span class="n">bytesread</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">vndx</span> <span class="o">=</span> <span class="n">servstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot; v&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vndx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_id</span> <span class="o">=</span> <span class="n">servstr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_id</span> <span class="o">=</span> <span class="n">servstr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">vndx</span><span class="p">]</span>
                <span class="n">tmpstr</span> <span class="o">=</span> <span class="n">servstr</span><span class="p">[</span><span class="n">vndx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
                <span class="n">endndx</span> <span class="o">=</span> <span class="n">tmpstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
                <span class="c"># print &quot;DEBUG: tmpstr:&quot;, tmpstr</span>
                <span class="c"># print &quot;DEBUG: tmpstr[0:endndx]:&quot;, tmpstr[0:endndx]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmpstr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">endndx</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;bad server ID/version string: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">servstr</span><span class="p">))</span>

        <span class="c"># Check the response to HELLO</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;seedlink&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;connected to: &#39;&quot;</span> <span class="o">+</span> <span class="n">servstr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">servstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">)]</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;ncorrect response to HELLO: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">servstr</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.requestInfo"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.requestInfo.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.requestInfo">[docs]</a>    <span class="k">def</span> <span class="nf">requestInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infoLevel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an INFO request to the SeedLink Connection Description.</span>

<span class="sd">        :param infoLevel: the INFO level (one of: ID, STATIONS, STREAMS, GAPS,</span>
<span class="sd">            CONNECTIONS, ALL)</span>

<span class="sd">        :raise SeedLinkException: if an INFO request is already pending.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">expect_info</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;cannot make INFO request, one is already pending&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_request_string</span> <span class="o">=</span> <span class="n">infoLevel</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.sendInfoRequest"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.sendInfoRequest.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.sendInfoRequest">[docs]</a>    <span class="k">def</span> <span class="nf">sendInfoRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">infoLevel</span><span class="p">,</span> <span class="n">verb_level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a request for the specified INFO level. The verbosity level</span>
<span class="sd">        can be specified, allowing control of when the request should be</span>
<span class="sd">        logged.</span>

<span class="sd">        :param infoLevel: the INFO level (one of: ID, STATIONS, STREAMS, GAPS,</span>
<span class="sd">            CONNECTIONS, ALL).</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        :raise IOException: if an I/O error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkVersion</span><span class="p">(</span><span class="mf">2.92</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">bytes</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;INFO &quot;</span> <span class="o">+</span> <span class="n">infoLevel</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;sending: requesting INFO level </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">infoLevel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verb_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendData</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;detected SeedLink version </span><span class="si">%s</span><span class="s"> does not support INFO requests&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.checkVersion"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.checkVersion.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.checkVersion">[docs]</a>    <span class="k">def</span> <span class="nf">checkVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks server version number against a given specified value.</span>

<span class="sd">        :param version: specified version value to test.</span>
<span class="sd">        :return: 1 if version is greater than or equal to value specified,</span>
<span class="sd">             0 if no server version is known, -1 if version is less than value</span>
<span class="sd">             specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.configLink"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.configLink.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.configLink">[docs]</a>    <span class="k">def</span> <span class="nf">configLink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure/negotiate data stream(s) with the remote SeedLink</span>
<span class="sd">        server.  Negotiation will be either uni- or multi-station</span>
<span class="sd">        depending on the value of &#39;multistation&#39; in this SeedLinkConnection.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        :raise SeedLinkException: if multi-station and SeedLink version does</span>
<span class="sd">            not support multi-station protocol.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multistation</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkVersion</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negotiateMultiStation</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;detected SeedLink version </span><span class="si">%s</span><span class="s"> does not support &quot;</span> <span class="o">+</span> \
                    <span class="s">&quot;multi-station protocol&quot;</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negotiateUniStation</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.negotiateStation"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.negotiateStation.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.negotiateStation">[docs]</a>    <span class="k">def</span> <span class="nf">negotiateStation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curstream</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Negotiate a SeedLink connection for a single station and issue</span>
<span class="sd">        the DATA command.</span>
<span class="sd">        If selectors are defined, then the string is parsed on space and each</span>
<span class="sd">        selector is sent.</span>
<span class="sd">        If &#39;seqnum&#39; != -1 and the SLCD &#39;resume&#39; flag is true then data is</span>
<span class="sd">        requested starting at seqnum.</span>

<span class="sd">        :param curstream: the description of the station to negotiate.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        :raise IOException: if an I/O error occurs.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Send the selector(s) and check the response(s)</span>
        <span class="n">selectors</span> <span class="o">=</span> <span class="n">curstream</span><span class="o">.</span><span class="n">getSelectors</span><span class="p">()</span>

        <span class="n">acceptsel</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># Count of accepted selectors</span>
        <span class="k">for</span> <span class="n">selector_str</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">selector_str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">SLNetStation</span><span class="o">.</span><span class="n">MAX_SELECTOR_SIZE</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;invalid selector: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">selector</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Build SELECT command, send it and receive response</span>
                <span class="n">sendStr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;SELECT &quot;</span> <span class="o">+</span> <span class="n">selector</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;sending: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sendStr</span><span class="p">))</span>
                <span class="nb">bytes</span> <span class="o">=</span> <span class="n">sendStr</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span>
                <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendData</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">,</span>
                                          <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">DFT_READBUF_SIZE</span><span class="p">)</span>
                <span class="n">readStr</span> <span class="o">=</span> <span class="n">bytesread</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

                <span class="c"># Check response to SELECT</span>
                <span class="k">if</span> <span class="n">readStr</span> <span class="o">==</span> <span class="s">&quot;OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;response: selector </span><span class="si">%s</span><span class="s"> is OK&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">selector</span><span class="p">))</span>
                    <span class="n">acceptsel</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">readStr</span> <span class="o">==</span> <span class="s">&quot;ERROR</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;response: selector </span><span class="si">%s</span><span class="s"> not accepted&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">selector</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;response: invalid response to SELECT command: </span><span class="si">%s</span><span class="s">&quot;</span>
                    <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">readStr</span><span class="p">))</span>

        <span class="c"># Fail if none of the given selectors were accepted</span>
        <span class="k">if</span> <span class="n">acceptsel</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;response: no data stream selector(s) accepted&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;response: </span><span class="si">%s</span><span class="s"> selector(s) accepted&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">acceptsel</span><span class="p">))</span>

        <span class="c"># Issue the DATA, FETCH or TIME action commands. A specified start (and</span>
        <span class="c"># optionally, stop time) takes precedence over the resumption from any</span>
        <span class="c"># previous sequence number.</span>

        <span class="n">sendStr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resume</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialup</span><span class="p">:</span>
                <span class="n">sendStr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;FETCH&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sendStr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;DATA&quot;</span>

            <span class="c"># Append the last packet time if the feature is enabled and server</span>
            <span class="c"># is &gt;= 2.93</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastpkttime</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkVersion</span><span class="p">(</span><span class="mf">2.93</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> \
               <span class="n">curstream</span><span class="o">.</span><span class="n">btime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Increment sequence number by 1</span>
                <span class="n">sendStr</span> <span class="o">+=</span> <span class="n">b</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot; &quot;</span> <span class="o">+</span> \
                    <span class="n">curstream</span><span class="o">.</span><span class="n">getSLTimeStamp</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;requesting resume data from 0x</span><span class="si">%s</span><span class="s"> (decimal: </span><span class="si">%s</span><span class="s">) at </span><span class="si">%s</span><span class="s">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                            <span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="n">curstream</span><span class="o">.</span><span class="n">getSLTimeStamp</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Increment sequence number by 1</span>
                <span class="n">sendStr</span> <span class="o">+=</span> <span class="n">b</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;requesting resume data from 0x</span><span class="si">%s</span><span class="s"> (decimal: </span><span class="si">%s</span><span class="s">)&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                   <span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">begin_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># begin time specified (should only be at initial startup)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkVersion</span><span class="p">(</span><span class="mf">2.92</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sendStr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;TIME &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">begin_time</span><span class="o">.</span>\
                    <span class="n">formatSeedLink</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">sendStr</span> <span class="o">+=</span> <span class="n">b</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">formatSeedLink</span><span class="p">()</span><span class="o">.</span>\
                        <span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;requesting specified time window&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;detected SeedLink version </span><span class="si">%s</span><span class="s"> does not support &quot;</span> <span class="o">+</span> \
                    <span class="s">&quot;TIME windows&quot;</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># default</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialup</span><span class="p">:</span>
                <span class="n">sendStr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;FETCH&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sendStr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;DATA&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;requesting next available data&quot;</span><span class="p">)</span>

        <span class="c"># Send action command and receive response</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;sending: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sendStr</span><span class="p">))</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="n">sendStr</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span>
        <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendData</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">,</span>
                                  <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">DFT_READBUF_SIZE</span><span class="p">)</span>

        <span class="c"># Check response to DATA/FETCH/TIME</span>
        <span class="n">readStr</span> <span class="o">=</span> <span class="n">bytesread</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">readStr</span> <span class="o">==</span> <span class="s">&quot;OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;response: DATA/FETCH/TIME command is OK&quot;</span><span class="p">)</span>
            <span class="n">acceptsel</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">readStr</span> <span class="o">==</span> <span class="s">&quot;ERROR</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;response: DATA/FETCH/TIME command is not accepted&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;response: invalid response to DATA/FETCH/TIME command: </span><span class="si">%s</span><span class="s">&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">readStr</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.negotiateUniStation"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.negotiateUniStation.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.negotiateUniStation">[docs]</a>    <span class="k">def</span> <span class="nf">negotiateUniStation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Negotiate a SeedLink connection in uni-station mode and issue the</span>
<span class="sd">        DATA command.  This is compatible with SeedLink Protocol version 2 or</span>
<span class="sd">        greater.</span>

<span class="sd">        If selectors are defined, then the string is parsed on space and each</span>
<span class="sd">        selector is sent.</span>
<span class="sd">        If &#39;seqnum&#39; != -1 and the SLCD &#39;resume&#39; flag is true then data is</span>
<span class="sd">        requested starting at seqnum.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        :raise IOException: if an I/O error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get stream (should be only stream present)</span>
        <span class="n">curstream</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">curstream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;cannot negotiate uni-station, stream list does not &quot;</span> <span class="o">+</span> \
                <span class="s">&quot;have exactly one element&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">curstream</span><span class="o">.</span><span class="n">net</span> <span class="o">==</span> <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">UNINETWORK</span> <span class="ow">and</span> \
           <span class="n">curstream</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">UNISTATION</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;cannot negotiate uni-station, mode not configured!&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c"># negotiate the station connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiateStation</span><span class="p">(</span><span class="n">curstream</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.negotiateMultiStation"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.negotiateMultiStation.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.negotiateMultiStation">[docs]</a>    <span class="k">def</span> <span class="nf">negotiateMultiStation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Negotiate a SeedLink connection using multi-station mode and</span>
<span class="sd">        issue the END action command.  This is compatible with SeedLink</span>
<span class="sd">        Protocol version 3, multi-station mode.</span>
<span class="sd">        If selectors are defined, then the string is parsed on space and each</span>
<span class="sd">        selector is sent.</span>
<span class="sd">        If &#39;seqnum&#39; != -1 and the SLCD &#39;resume&#39; flag is true then data is</span>
<span class="sd">        requested starting at seqnum.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        :raise IOException: if an I/O error occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acceptsta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;cannot negotiate multi-station, stream list is empty&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># Loop through the stream chain</span>
        <span class="k">for</span> <span class="n">curstream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>

            <span class="c"># A ring identifier</span>
            <span class="c"># slring = curstream.net + curstream.station</span>

            <span class="c"># Build STATION command, send it and receive response</span>
            <span class="n">sendStr</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;STATION  &quot;</span> <span class="o">+</span> <span class="n">curstream</span><span class="o">.</span><span class="n">station</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span>
                       <span class="n">curstream</span><span class="o">.</span><span class="n">net</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;strict&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;sending: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sendStr</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
            <span class="nb">bytes</span> <span class="o">=</span> <span class="n">sendStr</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span>
            <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">bytesread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendData</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">,</span>
                                      <span class="n">SeedLinkConnection</span><span class="o">.</span><span class="n">DFT_READBUF_SIZE</span><span class="p">)</span>
            <span class="n">readStr</span> <span class="o">=</span> <span class="n">bytesread</span>

            <span class="c"># Check response to SELECT</span>
            <span class="k">if</span> <span class="n">readStr</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;OK</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;response: station is OK (selected)&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">readStr</span> <span class="o">==</span> <span class="n">b</span><span class="s">&quot;ERROR</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;response: station not accepted, skipping&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;response: invalid response to STATION command: </span><span class="si">%s</span><span class="s">&quot;</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">readStr</span><span class="p">))</span>

            <span class="c"># negotiate the station connection</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negotiateStation</span><span class="p">(</span><span class="n">curstream</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">SeedLinkException</span> <span class="k">as</span> <span class="n">sle</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">sle</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">continue</span>
            <span class="n">acceptsta</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># Fail if no stations were accepted</span>
        <span class="k">if</span> <span class="n">acceptsta</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="s">&quot;no stations accepted&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> station(s) accepted&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">acceptsta</span><span class="p">))</span>

        <span class="c"># Issue END action command</span>
        <span class="n">sendStr</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;END&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;sending: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sendStr</span><span class="o">.</span><span class="n">decode</span><span class="p">()))</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="n">sendStr</span> <span class="o">+</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sendData</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sladdr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SeedLinkConnection.updateStream"><a class="viewcode-back" href="../../../../packages/autogen/obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.updateStream.html#obspy.seedlink.client.seedlinkconnection.SeedLinkConnection.updateStream">[docs]</a>    <span class="k">def</span> <span class="nf">updateStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slpacket</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the appropriate stream chain entry given a Mini-SEED record.</span>

<span class="sd">        :param slpacket: the packet containing a Mini-SEED record.</span>

<span class="sd">        :raise SeedLinkException: on error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seqnum</span> <span class="o">=</span> <span class="n">slpacket</span><span class="o">.</span><span class="n">getSequenceNumber</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">seqnum</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="s">&quot;could not determine sequence number&quot;</span><span class="p">)</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="n">slpacket</span><span class="o">.</span><span class="n">getTrace</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;blockette not 1000 (Data Only SEED Blockette) or other &quot;</span> <span class="o">+</span> \
                <span class="s">&quot;error reading miniseed data: </span><span class="si">%s</span><span class="s">&quot;</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="c"># read some blockette fields</span>
        <span class="n">net</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">station</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">btime</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">station</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span>
            <span class="n">net</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s">&#39;network&#39;</span><span class="p">]</span>
            <span class="n">btime</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s">&#39;starttime&#39;</span><span class="p">]</span>
            <span class="c"># print &quot;DEBUG: station, net, btime:&quot;, station, net, btime</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">se</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="s">&quot;trace header read error: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">se</span><span class="p">))</span>

        <span class="c"># For uni-station mode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">multistation</span><span class="p">:</span>
            <span class="n">curstream</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">curstream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;cannot update uni-station stream, stream list does &quot;</span> <span class="o">+</span> \
                    <span class="s">&quot;not have exactly one element&quot;</span>
                <span class="k">raise</span> <span class="n">SeedLinkException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">curstream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">=</span> <span class="n">seqnum</span>
            <span class="n">curstream</span><span class="o">.</span><span class="n">btime</span> <span class="o">=</span> <span class="n">btime</span>
            <span class="k">return</span>

        <span class="c"># For multi-station mode, search the stream chain</span>
        <span class="c"># Search for a matching net/station in the stream chain</span>
        <span class="c"># AJL 20090306 - Add support for IRIS DMC enhancements:</span>
        <span class="c"># Enhancements to the SeedLink protocol supported by the DMC&#39;s server</span>
        <span class="c"># allow network and station codes to be</span>
        <span class="c"># wildcarded in addition to the location and channel codes.</span>
        <span class="n">wildcarded</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">streams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">net</span> <span class="o">==</span> <span class="n">net</span> <span class="ow">and</span> <span class="n">stream</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="n">station</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="s">&quot;?&quot;</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">net</span> <span class="ow">or</span> <span class="s">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">net</span> <span class="ow">or</span> \
               <span class="s">&quot;?&quot;</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">station</span> <span class="ow">or</span> <span class="s">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">station</span><span class="p">:</span>
                <span class="c"># wildcard character found</span>
                <span class="n">wildcarded</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># print &quot;DEBUG: stream:&quot;, stream.net, stream.station, stream.btime</span>

        <span class="c"># update net/station entry in the stream chain</span>
        <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">seqnum</span> <span class="o">=</span> <span class="n">seqnum</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">btime</span> <span class="o">=</span> <span class="n">btime</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">wildcarded</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;unexpected data received: </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">station</span><span class="p">))</span></div></div>
</pre></div>

</div>

<footer>
<p class="text-muted small">
By the <a href="https://github.com/orgs/obspy/members">ObsPy
Development Team</a> and many <a href="#contributers" role="button"
data-toggle="modal" data-target="#contributers">Awesome Contributors</a> &nbsp;|&nbsp; Built with
<a href="http://getbootstrap.com/">Bootstrap</a> and
<a href="http://glyphicons.com//">Glyphicons</a> &nbsp;|&nbsp; Copyright 2008-2014
</p>
</footer>
<div id="contributers" class="modal fade" tabindex="-1"
role="dialog" aria-labelledby="contributersLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal"
aria-hidden="true">&times;</button>
<h3 class="modal-title" id="contributersLabel">Thank you!</h3>
</div>
<div class="modal-body">
<p>We would like to thank our contributors, whose efforts make
this software what it is. These people have helped by writing code
and documentation, and by testing. They have created and
maintained this product, its associated libraries and
applications, our build tools and our web sites.</p>
<h4>Contributors</h4>
<div class="container-fluid">
<div class="row">
<div class="col-md-6">
<ul>
<li>Adolfo Inza</li>
<li>Alessia Maggi</li>
<li>Anthony Lomax</li>
<li>Bernhard Morgenstern</li>
<li>Charles J. Ammon</li>
<li>Christian Sippl</li>
<li>Conny Hammer</li>
<li>Elliott Sales de Andrade</li>
<li>Fabian Engels</li>
<li>Gaute Hope</li>
<li>Joachim Saul</li>
<li>Lars Krieger</li>
<li>Lion Krischer</li>
<li>Marius Isken</li>
<li>Moritz Beyreuther</li>
<li>Paul Kufl</li>
<li>Philippe Lesage</li>
<li>Sebastian Heimann</li>
<li>Simon Kremers</li>
<li>Sven Egdorf</li>
<li>Thomas Lecocq</li>
<li>Tom Richter</li>
<li>Victor Kress</li>
<li>lafur St. Arnarsson</li>
</ul>
</div>
<div class="col-md-6">
<ul>
<li>Alberto Michelini</li>
<li>Andreas Khler</li>
<li>Arthur Snoke</li>
<li>Chad Trabant</li>
<li>Chris Scheingraber</li>
<li>Claudio Satriano</li>
<li>David Ketchum</li>
<li>Emiliano Russo</li>
<li>Felix Bernauer</li>
<li>Heiner Igel</li>
<li>Joachim Wassermann</li>
<li>Leonardo Uieda</li>
<li>Marcus Walther</li>
<li>Martin van Driel</li>
<li>Nathaniel C. Miller</li>
<li>Peter Danecek</li>
<li>Robert Barsch</li>
<li>Seyed Kasra Hosseini Zad</li>
<li>Stefan Stange</li>
<li>Sbastien Bonaim</li>
<li>Tobias Megies</li>
<li>Tommaso Fabbri</li>
<li>Yannik Behr</li>
</ul>
</div>
</div>
</div>
<h4>Funds</h4>
<p>ObsPy was partially funded by the</p>
<ul>
<li>German Science Foundation (DFG) via grant DFG IG 16/9-1</li>
<li>German Ministry for Education and Research (BMBF), GEOTECHNOLOGIEN grant 03G0646H.</li>
<li>NERA project (Network of European Research Infrastructures for Earthquake Risk Assessment and Mitigation) under the European Community&#39;s Seventh Framework Programme (FP7/2007-2013) grant agreement n 262330</li>
<li>Leibniz Institute for Applied Geophysics (LIAG)</li>
</ul>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
</div>
</div>
</div>

</div>


  </body>
</html>
